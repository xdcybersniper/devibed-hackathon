<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libris.ai | Social Reading</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
    --bg-main: #0f172a;
    --bg-card: rgba(30, 41, 59, 0.5);
    --accent: #3b82f6; /* Default Blue */
    --accent-glow: rgba(59, 130, 246, 0.3);
}

/* Theme Presets */
[data-theme="white"] { 
    --bg-main: #ffffff; 
    --bg-card: rgba(241, 245, 249, 0.8); /* Soft light grey cards */
    --accent: #0f172a; /* Slate Dark accents */
    --accent-soft: rgba(15, 23, 42, 0.05); 
    --text-main: #0f172a; /* Dark text for light background */
}
[data-theme="spotify"] { --bg-main: #040404; --accent: #1db954; --accent-glow: rgba(29, 185, 84, 0.3); }
[data-theme="cyber"] { --bg-main: #0b0118; --accent: #d946ef; --accent-glow: rgba(217, 70, 239, 0.3); }
[data-theme="ghost"] { --bg-main: #ffffff; --bg-card: #f1f5f9; --accent: #0f172a; --accent-glow: rgba(0,0,0,0.1); }

/* Applying the Theme to everything */
body { background-color: var(--bg-main); transition: background 0.4s ease; }
.text-blue-500, .text-blue-400, .text-emerald-400, .text-purple-400 { color: var(--accent) !important; }
.bg-blue-600, .bg-blue-500, .bg-emerald-500, .bg-purple-600 { background-color: var(--accent) !important; }
.border-blue-500, .border-slate-800 { border-color: var(--accent-glow) !important; }
    </style>
</head>
<body class="flex h-screen">

    <nav class="w-20 lg:w-64 border-r border-slate-800 flex flex-col justify-between p-4 glass z-50">
        <div class="space-y-8">
            <div class="flex items-center gap-3 px-2 text-blue-500">
                <i data-lucide="brain-circuit" class="w-8 h-8"></i>
                <span class="hidden lg:block font-bold text-xl tracking-tight">Libris.ai</span>
            </div>
            
            <div class="space-y-2" id="nav-buttons">
                <button onclick="showTab('read', this)" class="nav-item flex items-center gap-4 w-full p-3 rounded-xl hover:bg-slate-800 text-slate-400 hover:text-white transition nav-active">
                    <i data-lucide="book-open"></i> <span class="hidden lg:block">Read</span>
                </button>
                <button onclick="showTab('swipe', this)" class="nav-item flex items-center gap-4 w-full p-3 rounded-xl hover:bg-slate-800 text-slate-400 hover:text-white transition">
                    <i data-lucide="layers"></i> <span class="hidden lg:block">Book Tinder</span>
                </button>
                <button onclick="showTab('discuss', this)" class="nav-item flex items-center gap-4 w-full p-3 rounded-xl hover:bg-slate-800 text-slate-400 hover:text-white transition">
                    <i data-lucide="message-square"></i> <span class="hidden lg:block">Discussions</span>
                </button>
                <button onclick="showTab('communities', this)" class="nav-item flex items-center gap-4 w-full p-3 rounded-xl hover:bg-slate-800 text-slate-400 hover:text-white transition">
                    <i data-lucide="users"></i> <span class="hidden lg:block">Communities</span>
                </button>
                <button onclick="showTab('ai-search', this)" class="nav-item flex items-center gap-4 w-full p-3 rounded-xl hover:bg-slate-800 text-slate-400 hover:text-white transition">
                    <i data-lucide="sparkles" class="text-blue-400"></i> 
                    <span class="hidden lg:block">Memory AI</span>
                </button>
                <button onclick="showTab('identity', this)" class="nav-item flex items-center gap-4 w-full p-4 rounded-2xl hover:bg-slate-800 text-slate-400 hover:text-white transition">
                    <div class="p-1 rounded-lg bg-blue-500/10 group-hover:bg-blue-500/20 transition">
                        <i data-lucide="bar-chart-2" class="w-4 h-4 text-blue-400"></i>
                    </div>
                    <span class="font-bold text-sm tracking-tight hidden lg:block">Wrapped</span>
                </button>
                <button onclick="showTab('theme', this)" class="nav-item flex items-center gap-4 w-full p-4 rounded-2xl hover:bg-slate-800 text-slate-400 hover:text-white transition group">
                    <div class="p-1 rounded-lg bg-blue-500/10 group-hover:bg-blue-500/20 transition">
                        <i data-lucide="palette" class="w-4 h-4 text-blue-400"></i>
                    </div>
                    <span class="font-bold text-sm tracking-tight hidden lg:block">Theme Studio</span>
                </button>
            </div>
        </div>

        <button onclick="showTab('profile', this)" class="flex items-center gap-3 p-2 rounded-2xl hover:bg-slate-800 transition border-t border-slate-800 pt-6 mt-auto">
            <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center font-bold">JD</div>
            <div class="hidden lg:block text-left text-sm">
                <p class="font-semibold text-white">John Doe</p>
                <p class="text-slate-500 text-xs">Knowledge Level 42</p>
            </div>
        </button>
    </nav>
    
    <main class="flex-1 flex flex-col relative overflow-hidden">
        
        <header class="h-24 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900/50">
            <div class="flex gap-4 overflow-x-auto no-scrollbar py-2 max-w-2xl">
                <div class="flex-shrink-0 text-center space-y-1 cursor-pointer group">
                    <div class="w-14 h-14 rounded-full border-2 border-dashed border-slate-600 flex items-center justify-center group-hover:border-blue-500 transition">
                        <i data-lucide="plus" class="text-slate-500 group-hover:text-blue-500"></i>
                    </div>
                    <span class="text-[10px] text-slate-400">Add Story</span>
                </div>
                <div class="flex-shrink-0 text-center space-y-1">
                    <div class="w-14 h-14 rounded-full border-2 border-blue-500 p-0.5"><img src="https://i.pravatar.cc/100?u=1" class="rounded-full"></div>
                    <span class="text-[10px] text-slate-400">You</span>
                </div>
                <div class="flex-shrink-0 text-center space-y-1 opacity-80">
                    <div class="w-14 h-14 rounded-full border-2 border-pink-500 p-0.5"><img src="https://i.pravatar.cc/100?u=2" class="rounded-full"></div>
                    <span class="text-[10px] text-slate-400">Alex</span>
                </div>
                <div class="flex-shrink-0 text-center space-y-1 opacity-80">
                    <div class="w-14 h-14 rounded-full border-2 border-purple-500 p-0.5"><img src="https://i.pravatar.cc/100?u=3" class="rounded-full"></div>
                    <span class="text-[10px] text-slate-400">Sarah</span>
                </div>
            </div>

            <button class="relative p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition flex items-center gap-2 group">
                <span class="text-xs font-bold text-slate-400 group-hover:text-white uppercase tracking-widest hidden md:block">Messages</span>
                <i data-lucide="mail" class="w-5 h-5"></i>
                <span class="absolute -top-1 -right-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-slate-900"></span>
            </button>
        </header>

        <div id="content-viewport" class="flex-1 overflow-y-auto p-6 no-scrollbar">
            
            <section id="tab-read" class="tab-content max-w-3xl mx-auto space-y-8">
    
                <div class="flex items-center justify-between mb-4 sticky top-0 z-10 bg-[#0f172a]/80 backdrop-blur py-2">
                    <div id="horiz-nav" class="flex gap-2">
                        <button onclick="prevPage()" class="p-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-white transition disabled:opacity-30 disabled:cursor-not-allowed" id="prevBtn">
                            <i data-lucide="chevron-left" class="w-5 h-5"></i>
                        </button>
                        <span id="page-indicator" class="flex items-center px-4 bg-slate-800/50 rounded-lg text-xs font-bold text-blue-400 uppercase tracking-widest">
                            Page 1 / 3
                        </span>
                        <button onclick="nextPage()" class="p-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-white transition disabled:opacity-30 disabled:cursor-not-allowed" id="nextBtn">
                            <i data-lucide="chevron-right" class="w-5 h-5"></i>
                        </button>
                    </div>
            
                    <div class="flex bg-slate-800 rounded-lg p-1 text-[10px] font-bold uppercase tracking-widest border border-slate-700">
                        <button id="btn-vert" onclick="setReadMode('vertical')" class="px-3 py-1.5 rounded-md text-slate-500 transition">Vertical</button>
                        <button id="btn-horiz" onclick="setReadMode('horizontal')" class="px-3 py-1.5 rounded-md bg-blue-600 text-white transition">Horizontal</button>
                    </div>
                </div>
            
                <div id="reader-engine" class="mode-horizontal">
                    
                    <div class="reader-page active-page" id="p1">
                        <div class="space-y-2 mb-6">
                            <h1 class="text-4xl font-bold text-white">Beyond Good and Evil</h1>
                            <p class="text-blue-400 italic">Friedrich Nietzsche — Chapter 1: Prejudices of Philosophers</p>
                        </div>
                        <div class="text-lg leading-relaxed text-slate-300 space-y-6 text-justify pb-6">
                            <p>The Will to Truth, which is to tempt us to many a hazardous enterprise, the famous Truthfulness of which all philosophers have hitherto spoken with veneration, what questions has this Will to Truth not laid before us! What strange, perplexing, questionable questions!</p>
                            <p class="bg-blue-500/10 border-l-4 border-blue-500 p-6 rounded-r-2xl shadow-inner">"He who fights with monsters might take care lest he thereby become a monster."</p>
                        </div>
            
                        <div class="page-comments pt-8 border-t border-slate-800 mb-12">
                            <p class="text-xs font-bold text-blue-500 uppercase mb-4 tracking-widest">Marginalia: Page 1</p>
                            <div class="flex gap-4 group">
                                <img src="https://i.pravatar.cc/100?u=da-xa" class="w-10 h-10 rounded-full ring-2 ring-slate-800">
                                <div class="flex-1 text-left">
                                    <span class="font-bold text-sm text-white">da-xa</span>
                                    <p class="text-sm text-slate-300">The abyss is actually just a high-definition mirror.</p>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="reader-page" id="p2">
                        <div class="text-lg leading-relaxed text-slate-300 space-y-6 text-justify pb-6">
                            <p>Is it any wonder if we at last grow distrustful, lose patience, and turn impatiently away? That this Sphinx teaches us at last to ask questions ourselves? WHO is it really that puts questions to us here? WHAT really is this "Will to Truth" in us?</p>
                            <p>We believe that we can prove that all our "knowing" is an attempt to know our own nature in the objects... our "world" is our own nature.</p>
                        </div>
                        
                        <div class="page-comments pt-8 border-t border-slate-800 mb-12">
                            <p class="text-xs font-bold text-blue-500 uppercase mb-4 tracking-widest">Marginalia: Page 2</p>
                            <div class="flex gap-4 group">
                                <div class="w-10 h-10 rounded-full bg-orange-500/20 flex items-center justify-center font-bold text-orange-500 text-xs">B</div>
                                <div class="flex-1 text-left">
                                    <span class="font-bold text-sm text-orange-400">Bob_the_Reader</span>
                                    <p class="text-sm text-slate-300">Reminds me of Crime and Punishment.</p>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="reader-page" id="p3">
                        <div class="text-lg leading-relaxed text-slate-300 space-y-6 text-justify pb-6">
                            <p>The falseness of an opinion is not for us any objection to it... The question is, how far an opinion is life-furthering, life-preserving, species-preserving, perhaps species-rearing.</p>
                            <p>To recognize untruth as a condition of life; that is certainly to impugn the traditional ideas of value in a dangerous manner.</p>
                        </div>
                        
                        <div class="page-comments pt-8 border-t border-slate-800 mb-12">
                            <p class="text-xs font-bold text-blue-500 uppercase mb-4 tracking-widest">Marginalia: Page 3</p>
                            <p class="text-sm text-slate-500 italic">No notes on this page yet. Be the first to add one.</p>
                        </div>
                    </div>
            
                </div>
            
                <div id="vertical-footer-comments" class="hidden pt-12 border-t border-slate-800 pb-20">
                    <h3 class="text-2xl font-bold text-white mb-6 italic text-center">Chapter Discussion</h3>
                    <div class="bg-slate-800/30 p-8 rounded-3xl border border-slate-800">
                        <textarea id="chapter-comment-input" placeholder="Write a comment about the whole chapter..." class="w-full bg-transparent border-none focus:ring-0 text-sm resize-none h-24"></textarea>
                        <div class="flex justify-end mt-4">
                            <button onclick="postChapterComment()" class="bg-blue-600 px-6 py-2 rounded-xl text-xs font-bold transition">Post Comment</button>
                        </div>
                    </div>
                    <div class="mt-6">
                        <p class="text-xs font-bold text-blue-500 uppercase mb-3 tracking-widest">Latest comments</p>
                        <div id="chapter-comments-list" class="space-y-4"></div>
                    </div>
                </div>
            </section>
            <section id="tab-identity" class="tab-content hidden max-w-4xl mx-auto py-8 px-6 space-y-8">
    
                <div class="relative overflow-hidden rounded-[2.5rem] bg-gradient-to-br from-emerald-900 via-slate-900 to-black p-10 border border-emerald-500/20 shadow-2xl">
                    <div class="relative z-10 flex flex-col md:flex-row justify-between items-center gap-8">
                        <div class="text-center md:text-left">
                            <h4 class="text-emerald-400 font-black uppercase tracking-[0.4em] text-[10px] mb-2">Your Year in Books</h4>
                            <h2 class="text-6xl font-black tracking-tighter text-white mb-4">2026<br/><span class="text-emerald-500">WRAPPED</span></h2>
                            <p class="text-slate-400 text-sm max-w-xs">You lived a thousand lives this year. Here is the data to prove it.</p>
                        </div>
                        <div class="relative">
                            <img src="https://i.pravatar.cc/150?u=da-xa" class="w-40 h-40 rounded-full border-8 border-white/5 object-cover shadow-2xl">
                            <div class="absolute -top-2 -right-2 bg-white text-black font-black text-[10px] px-3 py-1 rounded-full uppercase italic rotate-12">Top 1%</div>
                        </div>
                    </div>
                    <div class="absolute -top-20 -left-20 w-64 h-64 bg-emerald-500/20 blur-[100px] rounded-full"></div>
                </div>
            
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div class="bg-[#1db954]/10 rounded-[2rem] p-8 border border-[#1db954]/20 flex flex-col items-center text-center group hover:bg-[#1db954]/20 transition-all cursor-default">
                        <p class="text-[#1db954] font-black uppercase text-[10px] tracking-widest mb-6">Your Top Author</p>
                        <div class="w-32 h-32 rounded-full overflow-hidden mb-4 ring-4 ring-[#1db954] ring-offset-4 ring-offset-[#0f172a]">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Nietzsche1882.jpg" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500">
                        </div>
                        <h3 class="text-2xl font-bold text-white">Friedrich Nietzsche</h3>
                        <p class="text-slate-400 text-sm mt-2">You spent <span class="text-white font-bold">4,280 minutes</span> in his head.</p>
                    </div>
            
                    <div class="bg-purple-600/10 rounded-[2rem] p-8 border border-purple-500/20 flex flex-col">
                        <p class="text-purple-400 font-black uppercase text-[10px] tracking-widest mb-8">Your Reading DNA</p>
                        <div class="space-y-4 flex-1">
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs font-bold"><span class="text-white">Philosophy</span><span class="text-purple-400">74%</span></div>
                                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                                    <div class="bg-purple-500 h-full w-[74%] rounded-full shadow-[0_0_10px_#a855f7]"></div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs font-bold"><span class="text-white">Cybernetics</span><span class="text-blue-400">18%</span></div>
                                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                                    <div class="bg-blue-500 h-full w-[18%] rounded-full"></div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs font-bold"><span class="text-white">Manga</span><span class="text-emerald-400">8%</span></div>
                                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                                    <div class="bg-emerald-500 h-full w-[8%] rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="md:col-span-2 bg-gradient-to-r from-blue-600 to-indigo-900 rounded-[2.5rem] p-10 relative overflow-hidden">
                        <p class="text-white/60 font-black uppercase text-[10px] tracking-widest mb-6">Your Top Thought</p>
                        <i data-lucide="quote" class="absolute right-10 top-10 w-24 h-24 text-white/10"></i>
                        <h3 class="text-3xl md:text-4xl font-serif italic text-white leading-tight max-w-xl">
                            "He who fights with monsters might take care lest he thereby become a monster."
                        </h3>
                        <div class="mt-8 flex items-center gap-4">
                            <div class="px-4 py-2 bg-white/10 backdrop-blur rounded-xl text-[10px] font-bold text-white uppercase tracking-widest">Saved 42 Times</div>
                            <div class="px-4 py-2 bg-white/10 backdrop-blur rounded-xl text-[10px] font-bold text-white uppercase tracking-widest">Shared 124 Times</div>
                        </div>
                    </div>
                </div>
            
                <div class="flex justify-center pt-8">
                    <button class="bg-[#1db954] hover:bg-[#1ed760] text-black font-black uppercase tracking-widest text-xs px-12 py-5 rounded-full shadow-xl shadow-[#1db954]/20 transition-all hover:scale-105 active:scale-95">
                        Share Your 2026 Wrapped
                    </button>
                </div>
            </section>
            <section id="tab-theme" class="tab-content hidden max-w-2xl mx-auto py-12 px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-black italic tracking-tighter uppercase text-white">Theme Studio</h2>
                    <p class="text-slate-500 text-sm mt-2 font-mono uppercase tracking-widest">Personalize your reading environment</p>
                </div>
            
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <button onclick="changeTheme('default')" class="group relative p-1 rounded-[2.5rem] bg-gradient-to-br from-blue-500 to-transparent">
                        <div class="bg-[#0f172a] p-8 rounded-[2.4rem] text-left">
                            <div class="w-10 h-10 rounded-full bg-blue-500 mb-4 shadow-lg shadow-blue-500/40"></div>
                            <h3 class="text-white font-bold text-lg">Default Logic</h3>
                            <p class="text-slate-500 text-xs mt-1">Clean, technical, and focused.</p>
                        </div>
                    </button>
            
                    <button onclick="changeTheme('white')" class="group relative p-1 rounded-[2.5rem] bg-gradient-to-br from-slate-400 to-transparent">
                        <div class="bg-white p-8 rounded-[2.4rem] text-left border border-slate-100">
                            <div class="w-10 h-10 rounded-full bg-white mb-4 shadow-md border border-slate-200"></div>
                            <h3 class="text-slate-900 font-bold text-lg">Pure White</h3>
                            <p class="text-slate-500 text-xs mt-1">High clarity for bright environments.</p>
                        </div>
                    </button>
            
                    <button onclick="changeTheme('spotify')" class="group relative p-1 rounded-[2.5rem] bg-gradient-to-br from-[#1db954] to-transparent">
                        <div class="bg-[#040404] p-8 rounded-[2.4rem] text-left">
                            <div class="w-10 h-10 rounded-full bg-[#1db954] mb-4 shadow-lg shadow-green-500/40"></div>
                            <h3 class="text-white font-bold text-lg">Libris Wrapped</h3>
                            <p class="text-slate-500 text-xs mt-1">Maximum contrast, high energy.</p>
                        </div>
                    </button>
            
                    <button onclick="changeTheme('cyber')" class="group relative p-1 rounded-[2.5rem] bg-gradient-to-br from-[#d946ef] to-transparent">
                        <div class="bg-[#0b0118] p-8 rounded-[2.4rem] text-left">
                            <div class="w-10 h-10 rounded-full bg-[#d946ef] mb-4 shadow-lg shadow-magenta-500/40"></div>
                            <h3 class="text-white font-bold text-lg">Neon Script</h3>
                            <p class="text-slate-500 text-xs mt-1">Vivid purples for late night reading.</p>
                        </div>
                    </button>
                </div>
            </section>
            <style>
                /* Mode Logic */
                .mode-horizontal .reader-page { display: none; }
                .mode-horizontal .reader-page.active-page { display: block; animation: fadeIn 0.3s ease; }
                .mode-horizontal .page-comments { display: block; }
            
                .mode-vertical .reader-page { display: block !important; margin-bottom: 0; padding-bottom: 2rem; }
                .mode-vertical .page-comments { display: none; }
                
                @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
            </style>
            
            <script>
                let currentPage = 1;
                const totalPages = 3;
            
                function updatePageVisibility() {
                    const mode = document.getElementById('reader-engine').classList.contains('mode-horizontal') ? 'horizontal' : 'vertical';
                    
                    if (mode === 'horizontal') {
                        document.querySelectorAll('.reader-page').forEach((p, idx) => {
                            p.classList.toggle('active-page', (idx + 1) === currentPage);
                        });
                        document.getElementById('page-indicator').innerText = `Page ${currentPage} / ${totalPages}`;
                        document.getElementById('prevBtn').disabled = (currentPage === 1);
                        document.getElementById('nextBtn').disabled = (currentPage === totalPages);
                        document.getElementById('horiz-nav').classList.remove('hidden');
                    } else {
                        document.getElementById('horiz-nav').classList.add('hidden');
                    }
                }
            
                function nextPage() { if (currentPage < totalPages) { currentPage++; updatePageVisibility(); window.scrollTo(0,0); } }
                function prevPage() { if (currentPage > 1) { currentPage--; updatePageVisibility(); window.scrollTo(0,0); } }
            
                function setReadMode(mode) {
                    const engine = document.getElementById('reader-engine');
                    const vertFooter = document.getElementById('vertical-footer-comments');
                    const btnVert = document.getElementById('btn-vert');
                    const btnHoriz = document.getElementById('btn-horiz');
            
                    if (mode === 'vertical') {
                        engine.className = 'mode-vertical';
                        vertFooter.classList.remove('hidden');
                        btnVert.classList.add('bg-blue-600', 'text-white');
                        btnVert.classList.remove('text-slate-500');
                        btnHoriz.classList.remove('bg-blue-600', 'text-white');
                        btnHoriz.classList.add('text-slate-500');
                    } else {
                        engine.className = 'mode-horizontal';
                        vertFooter.classList.add('hidden');
                        btnHoriz.classList.add('bg-blue-600', 'text-white');
                        btnHoriz.classList.remove('text-slate-500');
                        btnVert.classList.remove('bg-blue-600', 'text-white');
                        btnVert.classList.add('text-slate-500');
                    }
                    updatePageVisibility();
                }
                
                // Initialize icons
                lucide.createIcons();
            </script>

            <section id="tab-swipe" class="tab-content hidden flex flex-col items-center justify-center h-full pb-20">
                <div id="book-card" class="w-80 h-[500px] glass rounded-[2.5rem] overflow-hidden shadow-2xl relative cursor-pointer group" onclick="toggleBookDetails()">
                    <img id="card-image" src="https://images.unsplash.com/photo-1544947950-fa07a98d237f?q=80&w=800" class="w-full h-full object-cover transition duration-500 group-hover:scale-105">
                    <div class="absolute bottom-0 inset-x-0 p-8 bg-gradient-to-t from-black via-black/60 to-transparent">
                        <span id="card-tag" class="px-2 py-1 bg-blue-600 text-[10px] font-bold rounded mb-2 inline-block uppercase">Bestseller</span>
                        <h2 id="card-title" class="text-2xl font-bold">The Great Gatsby</h2>
                        <p id="card-author" class="text-slate-300 text-sm">F. Scott Fitzgerald</p>
                    </div>
                    <div id="card-details" class="absolute inset-0 bg-slate-900/95 p-8 opacity-0 pointer-events-none transition-opacity duration-300 overflow-y-auto no-scrollbar">
                        <h3 class="text-xl font-bold mb-4">The Plot</h3>
                        <p id="card-plot" class="text-sm text-slate-400 leading-relaxed mb-8">A story of ambition, unrequited love, and the elusive American Dream during the Roaring Twenties...</p>
                        <div class="border-t border-slate-800 pt-6">
                            <p class="text-xs font-bold uppercase text-blue-500 mb-4 tracking-tighter">Friends who read this</p>
                            <div class="flex -space-x-3">
                                <img src="https://i.pravatar.cc/100?u=4" class="w-10 h-10 rounded-full border-2 border-slate-900">
                                <img src="https://i.pravatar.cc/100?u=5" class="w-10 h-10 rounded-full border-2 border-slate-900">
                                <img src="https://i.pravatar.cc/100?u=6" class="w-10 h-10 rounded-full border-2 border-slate-900">
                                <div class="w-10 h-10 rounded-full bg-slate-800 border-2 border-slate-900 flex items-center justify-center text-[10px] font-bold text-slate-400">+12</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-10 mt-10">
                    <button onclick="nextCard('skip')" class="p-5 rounded-full bg-slate-800 text-red-500 hover:bg-red-500 hover:text-white transition-all transform active:scale-90"><i data-lucide="x" class="w-8 h-8"></i></button>
                    <button onclick="nextCard('save')" class="p-5 rounded-full bg-slate-800 text-green-500 hover:bg-green-500 hover:text-white transition-all transform active:scale-90"><i data-lucide="heart" class="w-8 h-8"></i></button>
                </div>
            </section>

            <section id="tab-discuss" class="tab-content hidden max-w-4xl mx-auto space-y-6">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h2 class="text-3xl font-bold">Global Threads</h2>
                        <p class="text-slate-500 text-sm">Join the conversation with knowledge seekers</p>
                    </div>
                    <button class="bg-blue-600 hover:bg-blue-500 px-6 py-2.5 rounded-xl text-sm font-bold transition">New Discussion</button>
                </div>
                <div class="glass p-6 rounded-2xl space-y-4 hover:border-slate-500 cursor-pointer transition">
                    <div class="flex items-center gap-2 text-xs text-slate-500 font-bold uppercase tracking-wider">
                        <span class="text-blue-400"># Philosophy</span> • Posted by u/PlatoLover
                    </div>
                    <h3 class="text-xl font-semibold">Is the "Allegory of the Cave" still relevant in the age of Generative AI?</h3>
                    <div class="flex gap-6 text-slate-500 text-sm">
                        <span class="flex items-center gap-1"><i data-lucide="message-circle" class="w-4 h-4"></i> 128 comments</span>
                        <span class="flex items-center gap-1"><i data-lucide="arrow-big-up" class="w-4 h-4"></i> 1.2k upvotes</span>
                    </div>
                </div>
            </section>

            <section id="tab-communities" class="tab-content hidden h-full flex gap-8">
                <div class="w-64 space-y-2">
                    <p class="text-xs font-bold text-slate-500 uppercase mb-6 tracking-widest">Your Circles</p>
                    <button class="w-full text-left p-3 rounded-xl bg-blue-500/10 text-blue-400 font-bold border-l-4 border-blue-500"># Sci-Fi Explorers</button>
                    <button class="w-full text-left p-3 rounded-xl text-slate-400 hover:bg-slate-800 transition"># Cyberpunk_Lore</button>
                    <button class="w-full text-left p-3 rounded-xl text-slate-400 hover:bg-slate-800 transition"># Business_Mindsets</button>
                </div>
                <div class="flex-1 glass rounded-[2rem] p-8">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-2xl font-bold">Guild Leaderboard</h2>
                        <span class="text-xs bg-slate-800 px-3 py-1 rounded-full text-slate-400 uppercase font-bold tracking-tighter">Season 4</span>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-5 bg-blue-500/10 border border-blue-500/20 rounded-2xl">
                            <div class="flex items-center gap-4">
                                <span class="text-2xl font-bold text-blue-500 italic">01</span>
                                <span class="font-bold">Sci-Fi Explorers</span>
                            </div>
                            <span class="text-blue-400 font-mono">14,203 pages</span>
                        </div>
                        <div class="flex justify-between items-center p-5 bg-slate-800/30 border border-slate-800 rounded-2xl opacity-60">
                            <div class="flex items-center gap-4">
                                <span class="text-2xl font-bold text-slate-600">02</span>
                                <span class="font-bold">Business Mindsets</span>
                            </div>
                            <span class="text-slate-400 font-mono">12,100 pages</span>
                        </div>
                    </div>
                </div>
            </section>

            <section id="tab-profile" class="tab-content hidden max-w-3xl mx-auto space-y-10">
                <div class="flex items-center gap-10">
                    <div class="w-40 h-40 rounded-[2.5rem] bg-gradient-to-tr from-blue-600 to-purple-600 flex items-center justify-center text-5xl font-bold shadow-2xl">JD</div>
                    <div class="space-y-4">
                        <h1 class="text-4xl font-bold">John Doe</h1>
                        <p class="text-slate-400 text-lg">"Searching for truth between the lines of code and philosophy."</p>
                        <div class="flex gap-8">
                            <div><p class="text-2xl font-bold">1.2k</p><p class="text-xs uppercase text-slate-500 font-bold">Following</p></div>
                            <div><p class="text-2xl font-bold">850</p><p class="text-xs uppercase text-slate-500 font-bold">Followers</p></div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass p-6 rounded-3xl space-y-4">
                        <p class="text-xs text-blue-500 uppercase font-bold tracking-widest">Reading Progress</p>
                        <p class="text-4xl font-bold italic">78%</p>
                        <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
                            <div class="w-[78%] h-full bg-blue-500"></div>
                        </div>
                    </div>
                    <div class="glass p-6 rounded-3xl flex flex-col justify-center">
                        <p class="text-xs text-purple-500 uppercase font-bold tracking-widest">Library Size</p>
                        <p class="text-4xl font-bold italic">142 <span class="text-lg text-slate-600 not-italic uppercase">Books Read</span></p>
                    </div>
                </div>
            </section>
            <section id="tab-ai-search" class="tab-content hidden max-w-3xl mx-auto h-[calc(100vh-120px)] flex flex-col">
    
                <div class="mb-8">
                    <h2 class="text-3xl font-bold flex items-center gap-3">
                        <i data-lucide="brain-circuit" class="text-blue-500"></i>
                        Memory Chat Bot
                    </h2>
                    <p class="text-slate-500 text-sm mt-2">Google по твоей личной истории чтения и мыслям.</p>
                </div>
            
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="glass p-4 rounded-2xl border-slate-800 hover:border-blue-500/50 transition cursor-pointer group" onclick="fillPrompt('Где я читал про «бездну», которая смотрит в ответ?')">
                        <i data-lucide="search" class="w-4 h-4 text-blue-500 mb-2"></i>
                        <p class="text-xs font-bold text-slate-300">«Где это было?»</p>
                        <p class="text-[10px] text-slate-500 mt-1 uppercase">Найти точную цитату</p>
                    </div>
                    <div class="glass p-4 rounded-2xl border-slate-800 hover:border-purple-500/50 transition cursor-pointer group" onclick="fillPrompt('Найди мысль из книги, которую я читал 3 года назад про силу воли')">
                        <i data-lucide="history" class="w-4 h-4 text-purple-500 mb-2"></i>
                        <p class="text-xs font-bold text-slate-300">«3 года назад»</p>
                        <p class="text-[10px] text-slate-500 mt-1 uppercase">Поиск по старым архивам</p>
                    </div>
                    <div class="glass p-4 rounded-2xl border-slate-800 hover:border-emerald-500/50 transition cursor-pointer group" onclick="fillPrompt('Мне сейчас нужно принять сложное решение, найди подходящую мысль из моих книг')">
                        <i data-lucide="lightbulb" class="w-4 h-4 text-emerald-500 mb-2"></i>
                        <p class="text-xs font-bold text-slate-300">«Нужная мысль»</p>
                        <p class="text-[10px] text-slate-500 mt-1 uppercase">Контекстный совет</p>
                    </div>
                </div>
            
                <div id="ai-chat-history" class="flex-1 overflow-y-auto no-scrollbar space-y-6 mb-6 p-4 rounded-3xl bg-slate-900/30 border border-slate-800/50">
                    <div class="flex gap-4">
                        <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="space-y-2 max-w-[80%]">
                            <p class="text-sm text-slate-300 leading-relaxed bg-slate-800/80 p-4 rounded-2xl rounded-tl-none">
                                Привет! Я проанализировал твои 142 прочитанные книги и 3,400 заметок. О чем хочешь вспомнить сегодня?
                            </p>
                        </div>
                    </div>
                </div>
            
                <div class="relative bg-slate-800/50 border border-slate-700 rounded-3xl p-2 focus-within:border-blue-500 transition-all">
                    <textarea id="ai-input" placeholder="Спроси свою память..." class="w-full bg-transparent border-none focus:ring-0 text-slate-200 text-sm resize-none h-14 p-3 pr-16"></textarea>
                    <button onclick="handleAiChat()" class="absolute right-3 bottom-3 bg-blue-600 hover:bg-blue-500 p-2.5 rounded-2xl transition shadow-lg shadow-blue-600/20">
                        <i data-lucide="arrow-up" class="w-5 h-5"></i>
                    </button>
                </div>
            </section>

        </div>
    </main>

    <script>
        lucide.createIcons();

        function showTab(tabId, btn) {
            // Content toggle
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');

            // Nav active state
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('nav-active'));
            if (btn && btn.classList.contains('nav-item')) {
                btn.classList.add('nav-active');
            }
        }

        function toggleBookDetails() {
            const details = document.getElementById('card-details');
            details.classList.toggle('opacity-0');
            details.classList.toggle('pointer-events-none');
        }

        let currentSwipeBookId = null;
        const API_BASE = (location.protocol === 'file:') ? 'http://127.0.0.1:5000' : '';

        function apiFetch(path, options) {
            return fetch(API_BASE + path, options);
        }

        async function loadCurrentBook() {
            try {
                const res = await apiFetch('/api/book/current');
                const data = await res.json();
                if (!data.book) return;
                renderBookCard(data.book);
            } catch (e) {
                // keep existing static card if backend is down
            }
        }

        function renderBookCard(book) {
            currentSwipeBookId = book.id;
            const img = document.getElementById('card-image');
            const title = document.getElementById('card-title');
            const author = document.getElementById('card-author');
            const tag = document.getElementById('card-tag');
            const plot = document.getElementById('card-plot');

            if (img) img.src = book.image_url || img.src;
            if (title) title.textContent = book.title || '';
            if (author) author.textContent = book.author || '';
            if (tag) tag.textContent = (book.tag || '').toUpperCase() || 'BOOK';
            if (plot) plot.textContent = book.plot || '';
        }

        async function nextCard(action) {
            const card = document.getElementById('book-card');
            const direction = action === 'skip' ? '-200%' : '200%';
            card.style.transform = `translateX(${direction}) rotate(${action === 'skip' ? '-30deg' : '30deg'})`;
            card.style.opacity = '0';
            
            setTimeout(() => {
                card.style.transition = 'none';
                card.style.transform = 'translateX(0) scale(0.8)';
                setTimeout(() => {
                    card.style.transition = 'transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }, 50);
            }, 400);

            // Persist swipe + fetch next card
            if (!currentSwipeBookId) return;
            try {
                const res = await apiFetch('/api/book/swipe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ book_id: currentSwipeBookId, action })
                });
                const data = await res.json();
                if (data.next_book) renderBookCard(data.next_book);
            } catch (e) {
                // no-op
            }
        }

        function addComment() {
            const input = document.getElementById('comment-input');
            const list = document.getElementById('comments-list');
            if (!input.value.trim()) return;

            const newComment = `
                <div class="flex gap-4 group animate-pulse">
                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center font-bold text-xs">JD</div>
                    <div class="flex-1 space-y-2">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-sm">John Doe (You)</span>
                            <span class="text-[10px] text-blue-500 uppercase font-bold">Just now</span>
                        </div>
                        <p class="text-sm text-white leading-relaxed">${input.value}</p>
                    </div>
                </div>
            `;
            list.insertAdjacentHTML('afterbegin', newComment);
            input.value = '';
            setTimeout(() => {
                list.firstElementChild.classList.remove('animate-pulse');
            }, 1000);
        }
        // Функция для быстрой подстановки промпта из плиток
        function fillPrompt(text) {
            document.getElementById('ai-input').value = text;
            document.getElementById('ai-input').focus();
        }

// Эмуляция чата (в будущем сюда прикрутим Gemini API)
        async function handleAiChat() {
            const input = document.getElementById('ai-input');
            const history = document.getElementById('ai-chat-history');
    
            if (!input.value.trim()) return;

    // Добавляем сообщение пользователя
            const userText = input.value;
            const userMsg = `
                <div class="flex gap-4 justify-end">
                    <div class="bg-blue-600/20 border border-blue-500/30 p-4 rounded-2xl rounded-tr-none max-w-[80%]">
                        <p class="text-sm text-slate-200">${userText}</p>
                    </div>
                </div>
            `;
            history.innerHTML += userMsg;
            history.scrollTop = history.scrollHeight;

            input.value = '';

            // Try backend first
            try {
                const res = await apiFetch('/api/ai/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userText })
                });
                const data = await res.json();
                const reply = data.reply || '...';
                const botMsg = `
                    <div class="flex gap-4">
                        <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="space-y-3 max-w-[80%]">
                            <div class="bg-slate-800/80 p-4 rounded-2xl rounded-tl-none border border-slate-700">
                                <p class="text-sm text-slate-300">${reply}</p>
                                <button onclick="setReadMode('horizontal')" class="mt-3 text-xs text-blue-400 font-bold border border-blue-500/30 px-3 py-1.5 rounded-lg hover:bg-blue-500 hover:text-white transition">Перейти к странице</button>
                            </div>
                        </div>
                    </div>
                `;
                history.innerHTML += botMsg;
                history.scrollTop = history.scrollHeight;
                lucide.createIcons();
            } catch (e) {
                // If backend is down, keep old demo behavior
                setTimeout(() => {
                    const botMsg = `
                        <div class="flex gap-4">
                            <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center flex-shrink-0">
                                <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                            </div>
                            <div class="space-y-3 max-w-[80%]">
                                <div class="bg-slate-800/80 p-4 rounded-2xl rounded-tl-none border border-slate-700">
                                    <p class="text-sm text-slate-300">Нашел! Ты читал это в <strong>"По ту сторону добра и зла"</strong> Ницше, 1-я глава. Твоя заметка от 12 мая 2023 года: <i>"Абсолютно согласен, бездна пугает"</i>.</p>
                                    <button onclick="setReadMode('horizontal')" class="mt-3 text-xs text-blue-400 font-bold border border-blue-500/30 px-3 py-1.5 rounded-lg hover:bg-blue-500 hover:text-white transition">Перейти к странице</button>
                                </div>
                            </div>
                        </div>
                    `;
                    history.innerHTML += botMsg;
                    history.scrollTop = history.scrollHeight;
                    lucide.createIcons();
                }, 1000);
            }
        }

        async function loadChapterComments() {
            const list = document.getElementById('chapter-comments-list');
            if (!list) return;
            try {
                const res = await apiFetch('/api/comments/chapter?limit=10');
                const data = await res.json();
                const comments = data.comments || [];
                list.innerHTML = comments.length
                    ? comments.map(c => `
                        <div class="bg-slate-800/30 border border-slate-800 rounded-2xl p-4">
                            <p class="text-sm text-slate-200 leading-relaxed">${escapeHtml(c.content)}</p>
                        </div>
                    `).join('')
                    : `<p class="text-sm text-slate-500 italic">No comments yet. Be the first.</p>`;
            } catch (e) {
                // ignore
            }
        }

        async function postChapterComment() {
            const input = document.getElementById('chapter-comment-input');
            if (!input) return;
            const content = input.value.trim();
            if (!content) return;
            try {
                await apiFetch('/api/comments/chapter', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content })
                });
                input.value = '';
                await loadChapterComments();
            } catch (e) {
                // ignore
            }
        }

        function escapeHtml(str) {
            return String(str)
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#039;');
        }
        function changeTheme(theme) {
            if (theme === 'default') {
                document.documentElement.removeAttribute('data-theme');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
    // Optional: Save to local storage
            localStorage.setItem('user-theme', theme);
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadCurrentBook();
            loadChapterComments();
        });
    </script>
</body>
</html>